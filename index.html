<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Web Bất Động Sản V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/global.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="components/hero-section.js"></script>
    <script type="module" src="components/main-layout-section.js"></script>
    <script type="module" src="components/main-content-section.js"></script>
    <script type="module" src="components/project-info-section.js"></script>
    <script type="module" src="components/map-location-section.js"></script>
    <script type="module" src="components/loan-calculator-section.js"></script>
    <script type="module" src="components/amenities-section.js"></script>
    <script type="module" src="components/chart-section.js"></script>
    <script type="module" src="components/broker-contact-section.js"></script>
</head>
<body class="font-sans bg-gray-100 text-gray-800">

    <div id="app-container">

        <hero-section
            id="pageHeroSection" title-text="Ngôi Nhà Hoàn Hảo, Cuộc Sống Trọn Vẹn"
            subtitle-text="Kiến tạo không gian sống đẳng cấp, nơi mọi khoảnh khắc đều đáng giá."
            button-text="Khám Phá Dự Án"
            background-image-url="https://placehold.co/1100x500/004238/FFFFFF?text=Hero+1100x500"
        ></hero-section>

        <main-layout-section class="py-8 md:py-12">
            <div slot="left-column-content">
                <main-content-section class="mb-8"></main-content-section>
                <project-info-section class="mb-8"></project-info-section>
                <map-location-section class="mb-8"></map-location-section>
                <loan-calculator-section class="mb-8"></loan-calculator-section>
                <amenities-section class="mb-8"></amenities-section>
                <chart-section class="mb-8"></chart-section>
            </div>

            <div slot="right-column-content" id="rightColumnSlot"> <broker-contact-section id="brokerContactWidget"></broker-contact-section>
            </div>
        </main-layout-section>

        <footer class="bg-secondary text-text-light text-center p-8 mt-12">
            <p>&copy; 2025 Công Ty Bất Động Sản V2. Bảo lưu mọi quyền.</p>
            <p>Liên hệ: info@batdongsanv2.com</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const heroSection = document.getElementById('pageHeroSection');
            const brokerContactWidget = document.getElementById('brokerContactWidget');
            const rightColumnSlot = document.getElementById('rightColumnSlot'); // The parent div in the slot

            if (!heroSection || !brokerContactWidget || !rightColumnSlot) {
                console.warn('Sticky broker: Required elements not found. Stickiness might not work.');
                return;
            }

            let placeholder = null; // Placeholder element
            const stickyOffsetTop = 32; // 32px, equivalent to Tailwind's top-8

            function updateBrokerContactStickiness() {
                const heroRect = heroSection.getBoundingClientRect(); // Position relative to viewport
                
                // Condition to stick: Bottom of hero is above the viewport's top edge (hero is scrolled out)
                if (heroRect.bottom < 0) {
                    if (!brokerContactWidget.classList.contains('broker-should-stick')) {
                        // Create or update placeholder BEFORE making broker sticky
                        if (!placeholder) {
                            placeholder = document.createElement('div');
                            placeholder.style.visibility = 'hidden'; // Keep it in flow but not visible initially
                            // Insert placeholder before the widget
                            brokerContactWidget.parentElement.insertBefore(placeholder, brokerContactWidget);
                        }
                        // Set placeholder height to current widget height to prevent layout jump
                        placeholder.style.height = brokerContactWidget.offsetHeight + 'px';
                        placeholder.style.width = '100%'; // Placeholder takes full width of its column
                        placeholder.style.display = 'block'; // Make placeholder occupy space

                        brokerContactWidget.classList.add('broker-should-stick');
                        // Set width explicitly because fixed position takes element out of flow
                        brokerContactWidget.style.width = rightColumnSlot.offsetWidth + 'px';
                    }
                } else { // Condition to unstick: Hero is at least partially in view
                    if (brokerContactWidget.classList.contains('broker-should-stick')) {
                        brokerContactWidget.classList.remove('broker-should-stick');
                        brokerContactWidget.style.width = ''; // Reset width, will take from its own styles or parent
                        if (placeholder) {
                            placeholder.style.display = 'none'; // Hide placeholder, it no longer needs to occupy space
                        }
                    }
                }
            }

            function handleResize() {
                // If the widget is sticky, its width needs to be updated on resize
                if (brokerContactWidget.classList.contains('broker-should-stick')) {
                    brokerContactWidget.style.width = rightColumnSlot.offsetWidth + 'px';
                }
                // If placeholder is active, update its height in case widget content changed affecting its natural height
                // This is more complex; for now, placeholder height is set at the moment of sticking.
                // A robust solution might re-evaluate placeholder height on resize if not sticky.
            }

            window.addEventListener('scroll', updateBrokerContactStickiness, { passive: true });
            window.addEventListener('resize', handleResize, { passive: true });

            // Initial check in case the page loads already scrolled or hero is very short
            // Ensure layout is stable before initial calculation
            setTimeout(() => {
                 handleResize(); // Calculate initial width for fixed state if needed
                 updateBrokerContactStickiness(); // Initial check for stickiness
            }, 100); // Small delay for initial render
        });
    </script>

</body>
</html>
